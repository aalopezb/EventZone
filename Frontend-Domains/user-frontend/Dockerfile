FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

# -----------------------------
ARG REACT_APP_REGISTER_SERVICE_URL
ARG REACT_APP_AUTH_SERVICE_URL
ARG REACT_APP_PROFILE_SERVICE_URL
ARG REACT_APP_ROLES_SERVICE_URL
ARG REACT_APP_PREFERENCES_SERVICE_URL
ARG REACT_APP_NOTIFICATIONS_SERVICE_URL
ARG REACT_APP_USER_ACTIVITY_SERVICE_URL
ARG REACT_APP_LOGIN_SERVICE_URL

RUN echo "REACT_APP_REGISTER_SERVICE_URL=${REACT_APP_REGISTER_SERVICE_URL}" > .env && \
    echo "REACT_APP_AUTH_SERVICE_URL=${REACT_APP_AUTH_SERVICE_URL}" >> .env && \
    echo "REACT_APP_PROFILE_SERVICE_URL=${REACT_APP_PROFILE_SERVICE_URL}" >> .env && \
    echo "REACT_APP_ROLES_SERVICE_URL=${REACT_APP_ROLES_SERVICE_URL}" >> .env && \
    echo "REACT_APP_PREFERENCES_SERVICE_URL=${REACT_APP_PREFERENCES_SERVICE_URL}" >> .env && \
    echo "REACT_APP_NOTIFICATIONS_SERVICE_URL=${REACT_APP_NOTIFICATIONS_SERVICE_URL}" >> .env && \
    echo "REACT_APP_USER_ACTIVITY_SERVICE_URL=${REACT_APP_USER_ACTIVITY_SERVICE_URL}" >> .env && \
    echo "REACT_APP_LOGIN_SERVICE_URL=${REACT_APP_LOGIN_SERVICE_URL}" >> .env

# -----------------------------
RUN cat .env  

RUN npm run build

RUN npm install -g serve

EXPOSE 5000

CMD ["serve", "-s", "build", "-l", "5000"]
